---
title: "Learning Logbook"
author: "Philipp Münker"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: yes
    toc_float: yes
    numbered: yes
    theme: journal
---



<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Tree dormacy 

* Dormacy establishment
* Endodormancy
* Ecodormancy
* Growth resumption


##### Dormacy establishment

Controlled by tempeature and photoperiod. 

##### Endodormancy

Controlled by plant endogenous factors. Plants unable to growth even under 
favorable environmental conditions. 

##### Ecodormancy

After a certain level of chill endodormancy has been overcome. 
Buds recover capacity to growth. Tree is aclimated freezing tolerance - not deeply
dormant. Growth is prevented by unsuitable environmental conditions. Temperature is 
the most important driver

### Task 1
##### 1. Put yourself in the place of a breeder who wants to calculate the temperature requirements of a newly released cultivar. Which method will you use to calculate the chilling and forcing periods? Please justify your answer.

Long penolocigal data does not exist => statistically approach is not optimal for newly released cultivar. 
It is better to work with the empirically approach. Collect Flower buds => take shoots and place them in a chamber for 10 days under 
favorable conditions (Temperature between 20 and 25 degrees) => After 10 days measure weight of shoots in chamber and shoots without chamber => If weight difference is bigger than 30 percent => Non dormant else => dormant 


### Task 2
##### 2. Which are the advantages (2) of the BBCH scale compared with earlies scales?

Not all the parts of a tree presents the same development sate. Early scales record only the 
Predominat state of the fruit tree. 
General principles for the design of a scale for plant growth stages: 

* Growth stages easily recognizable under fiels conditions

* Growth stages graded in the order of appearance (Early scale dont do that)

* Tow digit code: Principal growth stages| Secondary growth stages

* Aplicable for all cereals in all parts of the world. (Old scales can only used for a special grop/fruit)


### Task 3
##### Classify the following phenological stages of sweet cherry according to the BBCH scale:

![Picture 1 BBCH =55;  Picture 2 BBCH =67;  Picture 3 BBCH =89](./pheno_stages.png)





### Climate change and impact projection

### Task 1

##### List the main drivers of climate change at the decade to century scale, and briefly explain the mechanism through which the currently most important driver affects our climate. 



```{r,echo=FALSE}
library(readxl)
mod <- read_excel("Drivers of Climate Change.xlsx")
knitr::kable(head(mod), "pipe", caption = "Drivers of Climate Change")
```

The most important factor that currently has the greatest influence on climate and climate change is greenhouse gases.
The most important greenhouse gases are water vapour, (carbon dioxide) CO<sub>2</sub>, (methane) CH<sub>4</sub> and (nutrios oxides) N<sub>2</sub>O.Greenhouse gases can absorb only radiation of certain wavelengths. They absorb radiation with long wavelength, which comes from the earth surface. Infrared radiation which is emitted by warm earth surface. This radiation can not leave the atmosphere and is trapped by the greenhousgases and returns back to earth.  

### Task 2

##### Explain briefly what is special about temperature dynamics of the recent decades, and why we have good reasons to be concerned

Over the past decades and the whole of the last century, the temperature has been rising worldwide. Initially, this increase was relatively slow. 
The ten warmest 10 years worldwide since 1880 were all measured after the millennium. The five warmest years worldwide were all recorded after 2014. 
This effect is also noticeable in Germany. Here, too, the ten warmest years were all measured after 2000, with one exception. 
If one places the temperature increase of the last decades in the climate history of the last 1 million years, it can be seen that there has never been such a strong temperature increase over such a relatively short period of time.  
This rapid rise in temperature is developing an additional dynamic of its own. For example, high temperatures in the tundra cause the permafrost to thaw, which in turn releases a large amount of C0<sub>2</sub>, a greenhouse gas that promotes even faster warming. 



```{r, echo = FALSE}
 
```





### Manual Chill Analysis

### Task 1

```{r, message=FALSE,echo= FALSE}

library(tidyverse)
library(chillR)
library(knitr)
library(pander)
library(kableExtra)

```



```{r, echo=TRUE}
  
  #Clean Function
  
  cleaned_data = function(data_source){
  data_source = data_source[,c("Year","Month","Day","Hour","Temp")]
  return(data_source)  
  }

  # Apply Function to Winters_hours_gaps

  kable(head(cleaned_data(data_source = Winters_hours_gaps)),"pipe")


```



##### Write a basic function that calculates warm hours (>25°C)

```{r}
 
  WH<-function(hourtemps)
  {
    hourtemps[,"warm_hours"]<-hourtemps$Temp>=25.0
    return(hourtemps)
  }
```

### Task 2

##### Apply this function to the Winters_hours_gaps dataset

```{r, echo=TRUE}
# have a look to the data set
kable(head(Winters_hours_gaps), "pipe", caption = "Example Dataset: Winters_hours_gaps") 



```


```{r,}

# Apply Function 

 
hourtemps = cleaned_data(data_source=Winters_hours_gaps)
kable(head(WH(hourtemps = hourtemps)), "pipe")

```

### Task 3

##### Extend this function, so that it can take start and end dates as inputs and sums up warm hours between these dates





```{r}


warm_hours_function= function(Input_Data,S_Jahr,S_Monat,S_Tag, S_Stunde, E_Jahr,E_Monat,E_Tag, E_Stunde){


Start_Date<-which(hourtemps$Year== S_Jahr& hourtemps$Month==S_Monat &
                    hourtemps$Day==S_Tag & hourtemps$Hour==S_Stunde)
End_Date<-which(hourtemps$Year==E_Jahr & hourtemps$Month==E_Monat &
                  hourtemps$Day==E_Tag & hourtemps$Hour==E_Stunde)

# Apply Function Warm Hours (WH)
hourtemps= WH(hourtemps = Input_Data)

# Calculate warm_hours
warm_hours = sum(hourtemps$warm_hours[Start_Date:End_Date])


return(cat("The number of heat hours is:", paste(warm_hours)))

}

warm_hours_function(Input_Data=hourtemps,S_Jahr=2008,S_Monat=5,S_Tag=1,12,2008,8,31,12)


```
### Chill models

### Task 1

#### Run the chilling() function on the Winters_hours_gap dataset


```{r}

# run chilling function on Winters_hours_gap dataset 
output<-chilling(make_JDay(Winters_hours_gaps),Start_JDay = 90, End_JDay = 100)

# display result
kable(output)%>%
  kable_styling("striped", position = "left", font_size = 10)
```


### Task 2

#### Create your own temperature-weighting chill model using the step_model() function

```{r, echo= TRUE}
# have a look at the step model function

# Die Step Model Funktion besitzt zwei Argumente, die der Nutzer übergeben kann. 
# Einmal kann ein Datenset mit Temperaturdaten übergeben werden. 
# Hierfür steht das Argument HourTemp. 
# Dem Argument df kann ein data.frame übergeben werden. 
# Dies data.frame besteht aus lower, upper und weight. 
# Vordefiniert ist ist eine untere Temperaturgrenze von z.B -1000 °C bis 0 °C. 
# Alle Temperaturen, die in diesem Bereich liegen, werden dem Gewicht 0 zugeordnet. 
# Geht man davon aus, dass man stündliche Temperaturdaten als Input zur Verfügung stellt, 
# kann man die Temperatur mit dem entsprechenden Gewicht multiplizieren und man erhält 
# als Ergebnis die Menge der „chillhours“. 
# Zum Beispiel : -1 °C  liegt in dem Intervall [-1000,0] == 0 => 0 chillhours. 
# Ein weiteres Argument ist summ. Ist summ = TRUE werden die kummulierten chillhours über 
# einen definierten Zeitraum ausgeben. 
# Ist summ == FASLE gesetzt werden die Gewichte der chillhours ausgegeben. 


step_model <-function (HourTemp, df = 
                         data.frame(lower = c(-1000, 1.4, 2.4, 9.1, 12.4, 15.9, 18), 
                                    upper = c(1.4, 2.4, 9.1, 12.4, 15.9, 18, 1000), 
                                    weight = c(0, 0.5, 1, 0.5, 0, -0.5, -1)), summ = TRUE) 
{
    lower <- df$lower
    upper <- df$upper
    weight <- df$weight
    if (summ == TRUE) 
        return(cumsum(sapply(HourTemp, function(x) weight[which(x > 
            lower & x <= upper)])))
    else return(sapply(HourTemp, function(x) weight[which(x > 
        lower & x <= upper)]))
}



# define own temperature weighting

# Hier wird nur ein "eigenes Datenfeld" definiert mit eigenen Grenzen, die ein 
# eigenes Gewicht besitzen. 
# Zum Beispiel wird von -100 °C bis 0 °C das Gewicht == 0 gesetzt. 
# In diesem Fall findet keine "chillhour" statt. 
# Liegt die Temperatur hingegen zwischen 0 °C und 2 °C beträgt das Gewicht der 
# "chillhour" 0.5. Hier findet einen halbe "chillhour" statt. 

own_df = data.frame (lower  = c(-100,0,  2, 4,  5, 6,   7    ),
                     upper  = c(  0, 2,  4, 5,  6, 7,   100  ),
                     weight = c(  0, 0.5,1, 1.5,1, 0.5, 0    ))


# functional

use_step_model <- function(x){step_model(x,own_df)}


# quick aplly 

use_step_model(x= Winters_hours_gaps$Temp)[1:100]

```


### Task 3

#### Run this model on the Winters_hours_gaps dataset using the tempResponse() function.

The tempResponse function can display and summarise some chill models. Here is the 
the model "weather_mill" our own chilling model which is created by the step_model_funktion.
The modified stepmodel function is renamed by use_step_model and given as a parameter 
to the tempResponse function (weather_mill = use_step_mode). 
We can see a great 

```{r}
 output<-tempResponse(make_JDay(Winters_hours_gaps),Start_JDay = 30, End_JDay = 100,        models=list(Chill_Portions=Dynamic_Model, GDH=GDH, weather_mill = use_step_model,
 Utah_Model = Utah_Model))

kable(output) %>%
  kable_styling("striped", position = "left", font_size = 10)
```
If the Utah_Model is included, which is based on the default settings of the Step_Model, a clear difference between the modified Step Model and the Utah Model can be noted. 


